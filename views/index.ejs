<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Category Remover Tool</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/multi-select.css">
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css">
    <style>


    </style>

  </head>
  <body>
    <div class="container">
      <!-- NAVBAR -->
      <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" id="categories-tab" data-toggle="tab" href="#categories" role="tab" aria-controls="categories" aria-selected="true">Categories</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="businesses-tab" data-toggle="tab" href="#businesses" role="tab" aria-controls="businesses" aria-selected="false">Businesses</a>
        </li>

      </ul>
      <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="categories" role="tabpanel" aria-labelledby="categories-tab">
          <p id="select_buttons-categories" class="">
            <button type="button" class="btn btn-outline-primary" id="select-all" onclick="selectAll('categories');">Keep All</button>
            <button type="button" class="btn btn-outline-warning" id="deselect-all" onclick="deselectAll('categories');">Remove All</button>
          </p>
          <p class="">
            <select id='pre-selected-categories' multiple='multiple'>
              <% for(j=0; j < list.length; j++) { %>
                <option id='option_categories<%= j %>' value='<%= list[j][0] %>' selected><%= list[j][0] %></option>
                <% } %>
              </select>
            </p>
        </div>
        <div class="tab-pane fade" id="businesses" role="tabpanel" aria-labelledby="businesses-tab">

          <p id="select_buttons-businesses" class="">
            <button type="button" class="btn btn-outline-primary" id="select-all" onclick="selectAll('businesses');">Keep All</button>
            <button type="button" class="btn btn-outline-warning" id="deselect-all" onclick="deselectAll('businesses');">Remove All</button>
          </p>
          <p class="">
            <select id='pre-selected-categories' multiple='multiple'>
              <% for(j=0; j < list.length; j++) { %>
                <option id='option_businesses<%= j %>' value='<%= list[j][1] %>' selected><%= list[j][1] %></option>
                <% } %>
              </select>
            </p>

        </div>
      </div>

      <button type="button" class="btn btn-outline-primary" id="submit" onclick="submitSelect();">Submit</button>

    </div>

    <form action="/clean-list" method="post" id="categoryForm">
      <input type="hidden" value="" id="selectionValues" name="selection">
    </form>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="js/jquery.multi-select.js"></script>
    
    <% for(a=0; a < list.length; a++) { %>
      <%   let itemZero = "\"" + list[a][0] + "\"";  %>
      <%   let itemOne =  "\"" + list[a][1] + "\"";  %>
      <%   list[a] = "[" + itemZero + "," + itemOne + "]"; %>
      <% } %>
    <script type="text/javascript">
      var listArray = [<%- list.join(', \n') %>];

      // run pre selected options
      $('#pre-selected-categories').multiSelect({
          selectableHeader: "<div class='custom-header font-weight-bold text-center'>Categories to Remove</div>",
          selectionHeader: "<div class='custom-header font-weight-bold text-center'>Categories to Keep</div>"
        });

      function selectAll(type) {
        if(type == 'categories') {
          $('#pre-selected-categories').multiSelect('select_all');
        } else {
          $('#pre-selected-businesses').multiSelect('select_all');
        }
      };

      function deselectAll(type) {
        if(type == 'categories') {
          $('#pre-selected-categories').multiSelect('deselect_all');
        } else {
          $('#pre-selected-businesses').multiSelect('deselect_all');
        }
      };

      function getState(listType){
        let keep = new Array();
        let discard = new Array();

        for(i = 0; i < categoryArray.length; i++) {
          let opId = 'option_' + listType + i + '';

          if(document.getElementById(opId).selected) {
            keep.push( $("#" + opId).val() );
          } else {
            discard.push( $("#" + opId).val() );
          }
        }

        return { "keep": keep, "discard": discard };
      };

      function submitSelect() {
        let data = {
          "categories": getState('categories'),
          "businesses": getState('businesses')
        }

        document.getElementById('selectionValues').value = JSON.stringify(data);
        document.getElementById('categoryForm').submit();
      };



    </script>

    <script type="text/javascript">
      /* PRESETS */
        // 0. check if preset exists

        // 1. Create new preset
        // 2. Update existing preset
        // 3. Delete existing preset

        // 4. Select multiple presets
        // 5. Presets are used to choose which options are selected
        // 6. Apply Preset(s) button

        $('#pre-selected-categories').on('change', function(){
          /*
            let str = document.getElementById('businesses').innerText;
            let num = Number(str);
            num += 1;
            document.getElementById('businesses').innerText = num;
          */

          //updateBusinessList();
        });

    </script>

    <script>
      /*
        1. on category tab
          - show all categories (uniq)
        2. on busienss tab
          - show in their respective columns according to which column the categories are in
        3. resulting array is built based on business names
      */
    </script>

  </body>
</html>
